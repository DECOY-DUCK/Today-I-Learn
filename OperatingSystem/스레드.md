## 스레드

### **스레드란**

 운영체제가 새로운 프로세스를 생성하기 위해서는 프로세스 관리를 위해제어블록을 생성하고 작업에 필요한 메모리를 확보한 후 준비된 프로세스를 준비 큐에 삽입한다.

이렇게 생성된 프로세스를 CPU스케줄러가 CPU에게 전달하게 되는데, 그 작업단위가 스레드이다.그래서 운영체제 입장에서 프로세스가 작업단위가 되고 CPU 입장에서 스레드가 작업단위가 된다.

### **멀티스레드**

![image](https://user-images.githubusercontent.com/51963264/190116446-7a8e7ff1-b9cc-4704-a030-b2b307c87dec.png)


1개의 프로세스에 1개의 스레드가 있다면 단일 스레드라하고 2개이상 있다면 멀티 스레드라고 한다. 스레드끼리는 강하게 연결되어 있기 때문에 프로세스 내 자원을 공유할 수 있다. 그래서 자원의 중복사용을 피함으로써 낭비를 막을 수 있다. 하지만 여러 스레드가 하나의 자원을 공유하면서 생길 수 있는 여러 문제들(동시성제어,과도한 lock으로 인한 병목현상 등)이 발생할 수 있다.

### **Thread control block**

각 스레드는 스레드 제어블록을 가지고 있으며, 스레드 제어블록은 실행 중 레지스터 값, 우선순위, 스레드와 관련된 상태 정보를 갖고있다. 

또한 사용자 스택과 커널 스택을 가지고있는데, 사용자 주소 공간과 PCB를 공유함으로써 다른 스레드들이 데이터를 변경하면 다른 스레드들에게도 공유된 자원이기 때문에 같이 변경된다. 이로인해 프로세스 단위로 이루어 질때보다 빠르고 저렴하다.

### **멀티 스레드 모델**

![image](https://user-images.githubusercontent.com/51963264/190117787-a33e1ad9-024e-47d0-be57-2d02698aae22.png)


스레드는 커널 스레드와 사용자 스레드가 있다. 커널 스레드는 운영체제가 직접 생성하고 관리하는 스레드이고 사용자 스레드는 라이브러리에서 구현된 스레드이다. 그리고 사용자 스레드와 커널 스레드는 연결되는 방식에 따라 다양하게 구현할 수 있다.

![image](https://user-images.githubusercontent.com/51963264/190119252-d26f02db-793b-4785-9eaa-ee65780c2ca9.png)

- 다대일 모델: 다대일 모델은 하나의 커널 스레드에 여러개의 사용자 스레드가 연결된 형태이다. 초기 스레드 시스템에서 사용되었고 오늘날 이 모델을 채택하는 쓰템은 거의 없다. 이 모델은 사용자 레벨에서 스레드를 구현하기 때문에 스레드 관리는 라이브러리에서 구현된다. 그렇기 때문에 라이브러리가 직접 스케줄링하고 작업에 필요한 정보를 처리하기 때문에 문맥 교환 같은 부가적인 작업이 줄어들어 속도가 빠르다. 하지만 운영체제(커널)입장에서 다대일 모델은 하나의 커널 스레드로 동작하기 때문에 하나의 프로세스(단일 스레드)로 인식된다. 때문에 멀티코어 환경에서 CPU는 작업을 나눌 수 없어 효율이 떨어진다.

![image](https://user-images.githubusercontent.com/51963264/190119755-977841ff-17ac-4e99-98cb-c6b023b5b6d3.png)

- 일대일 모델: 일대일 모델은 커널 스레드가 멀티스레드를 관리 한다. 하나의 사용자 스레드가 하나의 커널 스레드와 연결된 형태이다. 커널 스레드는 독립적으로 스케줄링 되기 때문에 다른 스레드의 상태에 영향을 받지 않는다.

![image](https://user-images.githubusercontent.com/51963264/190119966-5ecb0acb-ed80-4fec-8914-23e754227cfe.png)

- 다대다 모델: 다수의 사용자 스레드에 사용자 스레드 수 보다 작거나 같은 수의 커널 스레드를 대응시키는 방법이다. 일대일 모델과 일대 다 모델을 혼용한 방식이기 때문에 두 모델의 장단점을 모두 가지고 있다.


